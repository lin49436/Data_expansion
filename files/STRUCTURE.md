# 项目文件结构

```
电能表数据生成系统/
│
├── main.py                         # 程序入口 (209 bytes)
│   └── 调用 csv_writer_and_main.main()
│
├── config.py                       # 配置模块 (1.1K)
│   ├── 时间配置
│   ├── 台区和电表配置
│   ├── 输出目录配置
│   ├── 供电单位编号
│   └── 异常类型定义
│
├── utils.py                        # 工具模块 (799 bytes)
│   ├── get_unified_org_no()       # 获取供电单位编号
│   ├── generate_time_series()     # 生成时间序列
│   └── generate_id()              # 生成ID
│
├── basic_data_generators.py       # 基础数据生成 (8.3K)
│   ├── generate_district_and_meters()  # 台区和电表
│   ├── generate_table_1_3()            # MK_1_3运行电能表
│   └── generate_table_1_4()            # MK_1_4运行计量自动化终端
│
├── anomaly_generators.py          # 异常数据生成 (30K)
│   ├── generate_table_1_27()      # MK_1_27历史故障清单
│   ├── generate_table_1_29()      # MK_1_29历史运维日志
│   ├── generate_table_1_30()      # MK_1_30风险等级清单
│   ├── generate_table_1_31()      # MK_1_31硬件状态
│   ├── generate_table_1_32()      # MK_1_32数据异常清单
│   ├── generate_table_1_33()      # MK_1_33计算异常清单
│   ├── generate_table_1_34()      # MK_1_34状态异常清单终端
│   ├── generate_table_ri_abnormal_meter()        # MK_1_35状态异常清单电能表
│   └── generate_table_ri_unsuccessful_meter()    # MK_1_36抄表不成功清单
│
├── curve_generators.py            # 曲线数据生成 (15K)
│   ├── generate_table_1_15()      # MK_1_15运行电能表功率曲线
│   └── generate_table_1_16()      # MK_1_16运行电能表电压电流曲线
│
├── csv_writer_and_main.py         # CSV写入和主程序 (28K)
│   ├── write_csv()                # CSV文件写入函数
│   └── main()                     # 主程序逻辑
│
├── README.md                       # 使用说明文档 (5.3K)
│
├── REFACTORING.md                  # 重构说明文档 (5.7K)
│
└── outputs/                        # 输出目录 (运行时生成)
    └── electric_meter_data/
        ├── MK_1_3运行电能表.csv
        ├── MK_1_4_运行计量自动化终端.csv
        ├── MK_1_27历史故障清单.csv
        ├── MK_1_29_历史运维日志清单.csv
        ├── MK_1_30_风险等级清单_手动录入.csv
        ├── MK_1_31_硬件状态.csv
        ├── MK_1_32_数据异常清单.csv
        ├── MK_1_33计算异常清单_手工录入_增量数据上送.csv
        ├── MK_1_34_状态异常清单终端.csv
        ├── MK_1_35_状态异常清单电能表.csv
        ├── MK_1_36_抄表不成功清单.csv
        ├── MK_1_15_运行电能表功率曲线.csv
        └── MK_1_16_运行电能表电压电流曲线.csv
```

## 模块调用关系图

```
┌─────────────┐
│   main.py   │  程序入口
└──────┬──────┘
       │
       ↓
┌─────────────────────────┐
│ csv_writer_and_main.py  │  主程序逻辑
│  - write_csv()          │  CSV写入
│  - main()               │  协调所有模块
└────────┬────────────────┘
         │
         ├─────────────────────────┐
         │                         │
         ↓                         ↓
┌────────────────┐       ┌──────────────────┐
│   config.py    │←──────│    utils.py      │
│  配置参数       │       │  工具函数         │
└────────────────┘       └──────────────────┘
         ↑                         ↑
         │                         │
         ├─────────┬───────────────┼────────┐
         │         │               │        │
         ↓         ↓               ↓        ↓
┌─────────────────────────────────────────────────┐
│            数据生成模块                          │
├────────────────┬──────────────┬─────────────────┤
│ basic_data_    │ anomaly_     │ curve_          │
│ generators.py  │ generators.py│ generators.py   │
│                │              │                 │
│ - 台区和电表   │ - 故障数据   │ - 功率曲线      │
│ - 运行电能表   │ - 运维日志   │ - 电压电流      │
│ - 自动化终端   │ - 风险等级   │                 │
│                │ - 硬件状态   │                 │
│                │ - 异常清单   │                 │
└────────────────┴──────────────┴─────────────────┘
```

## 数据流向图

```
                    ┌──────────────┐
                    │  时间序列生成  │
                    └───────┬──────┘
                            │
                            ↓
         ┌──────────────────┴──────────────────┐
         │                                      │
         ↓                                      ↓
┌─────────────────┐                  ┌──────────────────┐
│  基础数据生成   │                  │  异常数据生成     │
│                 │                  │                  │
│ - 台区信息      │←─────────────────│ - 关联基础数据   │
│ - 电表信息      │                  │ - 生成异常记录   │
│ - 终端信息      │                  │                  │
└────────┬────────┘                  └─────────┬────────┘
         │                                      │
         │          ┌──────────────┐           │
         └─────────→│ 曲线数据生成  │←──────────┘
                    │              │
                    │ - 关联异常   │
                    │ - 生成曲线   │
                    └──────┬───────┘
                           │
                           ↓
                    ┌──────────────┐
                    │  CSV文件输出  │
                    │              │
                    │ - 字段注释   │
                    │ - 数据写入   │
                    └──────┬───────┘
                           │
                           ↓
                    ┌──────────────┐
                    │  输出目录    │
                    │ 13个CSV文件  │
                    └──────────────┘
```

## 代码复杂度对比

### 原始单文件
```
data.py (1678行)
└── 所有功能混合
    - 配置、工具、生成、输出
    - 难以定位问题
    - 修改影响范围大
```

### 重构后多模块
```
7个模块文件 (总计 ~1700行)
├── config.py (43行)          → 配置管理
├── utils.py (31行)           → 工具函数
├── basic_data_generators.py  → 基础数据
├── anomaly_generators.py     → 异常数据
├── curve_generators.py       → 曲线数据
├── csv_writer_and_main.py    → 输出和主程序
└── main.py (11行)            → 程序入口
    
优势:
✓ 职责清晰
✓ 易于维护
✓ 方便测试
✓ 便于扩展
```

## 文件大小统计

| 文件 | 大小 | 说明 |
|------|------|------|
| main.py | 209 bytes | 入口文件 |
| utils.py | 799 bytes | 工具函数 |
| config.py | 1.1K | 配置参数 |
| basic_data_generators.py | 8.3K | 基础数据生成 |
| curve_generators.py | 15K | 曲线数据生成 |
| csv_writer_and_main.py | 28K | 主程序和输出 |
| anomaly_generators.py | 30K | 异常数据生成 |
| README.md | 5.3K | 使用说明 |
| REFACTORING.md | 5.7K | 重构说明 |
| **总计** | **~95K** | **9个文件** |
